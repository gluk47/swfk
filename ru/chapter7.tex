% !TeX encoding = UTF-8
% Use XeLaTeX to compile it
%
% Эта работа распространяется на условиях лицензии Creative Commons Attribution-Noncommercial-Share Alike 3.0 New Zealand License.
% Краткое описание лицензии есть тут: http://creativecommons.org/licenses/by-nc-sa/3.0/nz/deed.ru
% Полное — там же.
% Эту книгу можно невозбранно распространять и изменять, но только соблюдая следующие условия:
% сохраняя лицензию и не вводя дополнительных ограничений, бесплатно
% и указывая авторство как оригинальной части, так и изменённой.
% Автор оригинального английского текста — Jason R Briggs http://jasonrbriggs.com/
% Автор перевода — Егор Кочетов <Egor.Kochetoff@gmail.com>
%
% This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 3.0 New Zealand License.
% To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/3.0/nz
% or send a letter to Creative Commons, 171 Second Street, Suite 300, San Francisco, California, 94105, USA.
%

\chapter{Коротенькая глава про файлы}\label{ch:ashortchapteraboutfiles}\index{функции!file}

Может статься, ты уже слышал, что такое файлы (тем более, что в прошлой главе мы их использовали). Но я на всякий случай расскажу.

Наверное, тебе доводилось сталкиваться с такими плоскими полиэтиленовыми папками для бумаг на кольцах — они обычно называются файлами. В них можно вкладывать какие-то записи на русском, английском, удмуртском языках (например) и ещё приклеивать на них наклейку с названием. И потом их можно складывать в большие картонные папки, чтобы все эти файлики лежали рядом.

В компьютере всё примерно так же, только файлов можно создавать из ничего сколько угодно (ну… почти, пока место в компьютере не кончится). И у каждого файла всегда обязательно есть название. В файле может быть записано что угодно любой программой — мы, например, записывали в файлы текст простым текстовым редактором в предыдущих главах. И потом файл можно открыть любой программой — главное, чтобы программа, которая открывает файл, понимала тот «язык» (он называется «формат»), которым пользовалась программа, которая создавала файл. Файлы в компьютере можно складывать в папки, или директории\footnote{На самом деле, директория — тоже файл: в нём просто перечислен список, какие именно файлы лежат внутри.}. Если аккуратно разложить все файлы в компьютере по папкам, то в них существенно проще ориентироваться, чем если они лежат кучей в одной папке или в беспорядке в разных папках.

Мы уже использовали объект, описывающий файл в Питоне, в предыдущей главе, таким образом:

\begin{WINDOWS}

\begin{listing}
\begin{verbatim}
>>> f = open('c:\\test.txt')
>>> print(f.read())
\end{verbatim}
\end{listing}

\end{WINDOWS}

\begin{MAC}

\begin{listing}
\begin{verbatim}
>>> f = open('Desktop/test.txt')
>>> print(f.read())
\end{verbatim}
\end{listing}

\end{MAC}

\begin{LINUX}

\begin{listing}
\begin{verbatim}
>>> f = open('test.txt')
>>> print(f.read())
\end{verbatim}
\end{listing}
 

Так мы открываем для чтения файл «test.txt». Файл при этом находится в \emph{текущей папке}. Когда ты запускаешь Питон из консоли, то текущая папка остаётся той, которая была. Если ты не делал специальных манипуляций, то это просто домашняя папка. Если бы тебе хотелось напечатать файл «письмо.txt», который лежит в папке «почта», то надо было бы написать так:
\begin{listing}
\begin{verbatim}
>>> f = open ('почта/письмо.txt')
>>> print(f.read())
\end{verbatim}
\end{listing}

\end{LINUX}

Файловый объект (он же объект типа \code{file}) не ограничивается только функцией \code{read}. В конце концов, если бы в папку с документами нельзя было добавить новых, мало пользы было бы от такой папки.

Мы можем создать новый пустой файл, передав ещё один параметр функции \code{open}, вот так:

\begin{listing}
\begin{verbatim}
>>> f = open('myfile.txt', 'w')
\end{verbatim}
\end{listing}

Параметр «w» — сокращение от английского «write» — записать. Так мы Питону говорим, что нам из этого файла не надо ничего читать, надо только записывать. Поэтому если файл с таким именем уже есть, то он будет тут же очищен, а если его нет — то будет создан новый пустой.

Можем что-нибудь записать в этот файл:

\begin{listing}
\begin{verbatim}
>>> f = open('myfile.txt', 'w')
>>> f.write('что-нибудь')
\end{verbatim}
\end{listing}

Теперь надо сказать Питону закрыть файл. Потому что к этому моменту он запомнил, что надо будет записать в файл \code{f} всё, что мы попросили, но ещё не записывал. Запоминать быстро, а записывать в файл — долго. По-настоящему Питон запишет в файл, только если программа завершится (то есть если закрыть консоль Питона, в которой мы открыли файл); или если помнить придётся слишком много — тогда какую-то часть Питон запишет в файл, а остальную будет всё ещё держать в уме; или если явно попросить Питон записать в файл всё, что нужно — например, функцией \code{close}:

\begin{listing}
\begin{verbatim}
>>> f = open('myfile.txt', 'w')
>>> f.write('что-нибудь')
>>> f.close()
\end{verbatim}
\end{listing}

Можешь теперь этот файл открыть текстовым редактором и прочитать там записанный текст. Можно, опять-таки, воспользоваться Питоном для чтения текста:

\begin{listing}
\begin{verbatim}
>>> f = open('myfile.txt')
>>> print(f.read())
this is a test file
\end{verbatim}
\end{listing}

Может показаться странным, зачем все эти хитрости с запоминанием и записыванием только потом. Простой ответ — чтобы было быстрее.

Дело в том, что записывать в файл может быть в тысячу раз медленнее, чем запоминать (в \emph{оперативную память}). Чтобы хоть как-то это исправить, в файл пишут сразу большой кусочек данных за раз, так получается быстрее. Всё, что меньше, чем размер кусочка, Питон держит в памяти. Ещё бывает, что нужно что-то записать в файл, потом в другом месте программы это прочитать из файла, а потом файл и вовсе удалить за ненадобностью. Так вот если данных немного, то их можно и совсем не записывать в файл, а только запомнить, что сильно ускоряет работу программы. Вообще, подобным образом с файлами обращается не только Питон, но и большинство программ.

\newpage