% !TeX encoding = UTF-8
% Use XeLaTeX to compile it
%
% Эта работа распространяется на условиях лицензии Creative Commons Attribution-Noncommercial-Share Alike 3.0 New Zealand License.
% Краткое описание лицензии есть тут: http://creativecommons.org/licenses/by-nc-sa/3.0/nz/deed.ru
% Полное — там же.
% Эту книгу можно невозбранно распространять и изменять, но только соблюдая следующие условия:
% сохраняя лицензию и не вводя дополнительных ограничений, бесплатно
% и указывая авторство как оригинальной части, так и изменённой.
% Автор оригинального английского текста — Jason R Briggs http://jasonrbriggs.com/
% Автор перевода — Егор Кочетов <Egor.Kochetoff@gmail.com>
%
% This work is licensed under the Creative Commons Attribution-Noncommercial-Share Alike 3.0 New Zealand License.
% To view a copy of this license, visit http://creativecommons.org/licenses/by-nc-sa/3.0/nz
% or send a letter to Creative Commons, 171 Second Street, Suite 300, San Francisco, California, 94105, USA.
%

\chapter{Коротенькая глава про файлы}\label{ch:ashortchapteraboutfiles}\index{функции!file}

Может статься, ты уже слышал, что такое файлы (тем более, что в прошлой главе мы их использовали). Но я на всякий случай расскажу.

Наверное, тебе доводилось сталкиваться с такими плоскими полиэтиленовыми папками для бумаг на кольцах — они обычно называются файлами. В них можно вкладывать какие-то записи на русском, английском, удмуртском языках (например) и ещё приклеивать на них наклейку с названием. И потом их можно складывать в большие картонные папки, чтобы все эти файлики лежали рядом.

В компьютере всё примерно так же, только файлов можно создавать из ничего сколько угодно (ну… почти, пока место в компьютере не кончится). И у каждого файла всегда обязательно есть название. В файле может быть записано что угодно любой программой — мы, например, записывали в файлы текст простым текстовым редактором в предыдущих главах. И потом файл можно открыть любой программой — главное, чтобы программа, которая открывает файл, понимала тот «язык» (он называется «формат»), которым пользовалась программа, которая создавала файл. Файлы в компьютере можно складывать в папки, или директории\footnote{На самом деле, директория — тоже файл: в нём просто перечислен список, какие именно файлы лежат внутри.}. Если аккуратно разложить все файлы в компьютере по папкам, то в них существенно проще ориентироваться, чем если они лежат кучей в одной папке или в беспорядке в разных папках.

Мы уже использовали объект, описывающий файл в Питоне, в предыдущей главе, таким образом:

\begin{WINDOWS}

\begin{listing}
\begin{verbatim}
>>> f = open('c:\\test.txt')
>>> print(f.read())
\end{verbatim}
\end{listing}

\end{WINDOWS}

\begin{MAC}

\begin{listing}
\begin{verbatim}
>>> f = open('Desktop/test.txt')
>>> print(f.read())
\end{verbatim}
\end{listing}

\end{MAC}

\begin{LINUX}

\begin{listing}
\begin{verbatim}
>>> f = open('test.txt')
>>> print(f.read())
\end{verbatim}
\end{listing}

Так мы открываем для чтения файл «test.txt». Файл при этом находится в \emph{текущей папке}. Когда ты запускаешь Питон из консоли, то текущая папка остаётся той, которая была. Если ты не делал специальных манипуляций, то это просто домашняя папка. Если бы тебе хотелось напечатать файл «письмо.txt», который лежит в папке «почта», то надо было бы написать так:
\begin{listing}
\begin{verbatim}
>>> f = open ('почта/письмо.txt')
>>> print(f.read())
\end{verbatim}
\end{listing}

\end{LINUX}

Файловый объект (он же объект типа \code{file}) не ограничивается только функцией \code{read}. В конце концов, если бы в папку с документами нельзя было добавить новых, мало пользы было бы от такой папки.

Мы можем создать новый пустой файл, передав ещё один параметр функции \code{open}, вот так:

\begin{listing}
\begin{verbatim}
>>> f = open('myfile.txt', 'w')
\end{verbatim}
\end{listing}

Параметр «w» — сокращение от английского «write» — записать. Так мы Питону говорим, что нам из этого файла не надо ничего читать, надо только записывать. Поэтому если файл с таким именем уже есть, то он будет тут же очищен, а если его нет — то будет создан новый пустой.

Можем что-нибудь записать в этот файл:

\begin{listing}
\begin{verbatim}
>>> f = open('myfile.txt', 'w')
>>> f.write('что-нибудь')
\end{verbatim}
\end{listing}

Теперь открой этот файл в текстовом редакторе. Файл будет пустой. Почему — мы выясним чуть позже.

\begin{WINDOWS}
Если ты используешь в качестве текстового редактора блокнот, то закрой его, чтобы Питон смог всё-таки записать в файл всё, что мы просили.
\end{WINDOWS}

Чтобы в файле появилось всё, что нужно, надо сказать Питону закрыть файл. Потому что к этому моменту он запомнил, что \emph{надо будет} записать в файл \code{f} всё, что мы попросили, но ещё не записывал. Запоминать быстро, а записывать в файл — долго. По-настоящему Питон запишет в файл, только если программа завершится (то есть если закрыть консоль Питона, в которой мы открыли файл); или если помнить придётся слишком много — тогда какую-то часть Питон запишет в файл, а остальную будет всё ещё держать в уме; или если явно попросить Питон записать в файл всё, что нужно — например, функцией \code{close}:

\begin{listing}
\begin{verbatim}
>>> f = open('myfile.txt', 'w')
>>> f.write('что-нибудь')
>>> f.close()
\end{verbatim}
\end{listing}

Если теперь этот файл открыть текстовым редактором, то там будет записанный текст. Можно, опять-таки, воспользоваться Питоном для чтения текста:

\begin{listing}
\begin{verbatim}
>>> f = open('myfile.txt')
>>> print(f.read())
что-нибудь
\end{verbatim}
\end{listing}

После того как файл закрыт функцией \code{close}, в него больше нельзя ничего записать. Если потом захочется дописать что-то в конец этого файла, то надо его снова открыть, но вот так:

\begin{listing}
\begin{verbatim}
>>> f = open('myfile.txt', 'a')
\end{verbatim}
\end{listing}

Параметр «a» — сокращение от английского «append», то есть «добавить». Если теперь записывать в файл \code{f}, то всё записанное появится в конце файла после всего того, что там уже было.

\begin{center}
\fbox{\colorbox{PaleBlue}{\parbox{.85\linewidth} {
\subsection*{Почему бы не записывать сразу?}
Наверное, кажется странным, зачем такие хитрости с запоминанием и записыванием только потом. Простой ответ — чтобы было быстрее.

Дело в том, что записывать в файл может быть в тысячу раз медленнее, чем запоминать (в \emph{оперативную память}). Чтобы хоть как-то это исправить, в файл пишут сразу большой кусочек данных за раз, так получается быстрее. Всё, что меньше, чем размер кусочка, Питон держит в памяти. Ещё бывает, что нужно что-то записать в файл, потом в другом месте программы это прочитать из файла, а потом файл и вовсе удалить за ненадобностью. Так вот если данных немного, то их можно и совсем не записывать в файл, а только запомнить, что сильно ускоряет работу программы. Вообще, подобным образом с файлами обращается не только Питон, но и большинство программ.
}}}
\end{center}

\section{Чем развлечься на досуге}

\emph{В этой главе мы обсудили, что же такое файл, наконец, а ещё как файлы читать и как в них записывать. Узнали, что Питон записывает в файл не сразу и почему он так делает: чтобы было быстрее}.

\subsection*{Упражнение}

Часто людям приходится копировать файлы, и ты наверняка с этим сталкивался — например, копируя файлы на флэшку, чтобы отнести в школу.

Напиши функцию \code{copy} с двумя параметрами: файлом, который надо скопировать и новым именем файла.
Функция должна посчитать количество строк в файле и потом скопировать один файл в другой, строчка за строчкой, выводя после каждой строчки, сколько ещё осталось копировать.

Чтобы перебрать все строчки файла \code{f} одну за одной, надо использовать вот такой код:
\begin{listing}
\begin{verbatim}
for line in f:
	... # очередная строчка файла записана в переменную line
\end{verbatim}
\end{listing}

Функция \code{write} возвращает значение: количество записанных символов. Если оно печатается в консоль при выполнении функции, просто присваивай это значение какой-нибудь переменной (например, так: \code{w = newfile.write (line)}).

Чтобы проверить, работает ли функция, вызови её:

\begin{listing}
\begin{verbatim}
>>> copy ('myfile.txt', 'mynewfile.txt')
\end{verbatim}
\end{listing}

Открой файл «mynewfile.txt» в текстовом редакторе и проверь, что внутри у него то же самое, что и в «myfile.txt». Если нет, проверь, не забыл ли ты закрыть новый файл (\code{close}), чтобы Питон записал туда всё, что держит в уме.

\newpage